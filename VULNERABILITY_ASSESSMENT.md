# Analisa Kerentanan Aplikasi (Static Reverse Engineering)

> **Scope**: hasil ini berasal dari analisa statis terhadap `AndroidManifest.xml`, konfigurasi resource XML, dan potongan bytecode smali. Tidak ada uji dinamis pada backend Google production.

## Ringkasan Eksekutif

Dari artefak yang tersedia, ada beberapa temuan dengan tingkat risiko tinggi. Satu rantai yang paling realistis adalah:

1. **Permissions Bypass / Auth Bypass (Intent Spoofing)** pada komponen `BroadcastReceiver` yang `exported=true` tanpa `android:permission`.
2. Trigger berulang dapat mendorong **Denial of Service (DoS)** terhadap proses aplikasi (CPU/battery/IO churn).
3. Konfigurasi `usesCleartextTraffic="true"` + deep link `http` menambah paparan **Mixed Content / Information Leak** pada jaringan tidak tepercaya.
4. Hardcoded API key dalam manifest meningkatkan risiko **Sensitive Data Exposure** (penyalahgunaan kunci bila pembatasan server lemah).

---

## Temuan 1 — Permissions Bypass / Auth Bypass via Exported Receiver

### Kategori
- **Permissions Bypass**
- **Auth Bypass**
- **Denial of Service (DoS)** (sebagai dampak lanjutan)

### Bukti Teknis
- Receiver berikut dideklarasikan `exported="true"` tanpa `android:permission`:
  - `com.google.android.apps.gmm.geofence.GeofenceBroadcastReceiver` dengan action custom `...GEOFENCE_RECEIVER_ACTION`.
- `onReceive` pada receiver memproses extras geofence (`gms_error_code`, `com.google.android.location.intent.extra.transition`) dan mengeksekusi pekerjaan async (`goAsync`) + operasi lanjutan, tanpa validasi asal pengirim broadcast pada potongan yang terlihat.

### Kenapa ini serius
- Karena receiver exported dan tidak diproteksi permission, **aplikasi pihak ketiga** di device yang sama bisa mengirim broadcast explicit langsung ke komponen ini.
- Ini membuka peluang bypass trust boundary internal (komponen yang mestinya dipicu ekosistem Google Play Services) -> **authz bypass di level IPC Android**.
- Broadcast spam dapat menimbulkan **DoS lokal** (resource exhaustion, spam task, drain baterai).

### Realistic Exploit Path
1. Attacker app (tanpa permission spesial) mengirim explicit broadcast ke `GeofenceBroadcastReceiver`.
2. Menyisipkan extras transisi geofence palsu.
3. Receiver memproses seolah event valid, memicu workflow internal.
4. Ulangi dalam frekuensi tinggi untuk menurunkan performa app/device.

### PoC (ADB)
```bash
adb shell am broadcast \
  -n com.google.android.apps.maps/com.google.android.apps.gmm.geofence.GeofenceBroadcastReceiver \
  -a com.google.android.apps.gmm.geofence.GeofenceBroadcastReceiver.GEOFENCE_RECEIVER_ACTION \
  --ei gms_error_code 0 \
  --ei com.google.android.location.intent.extra.transition 1
```

**PoC flood (DoS simulation ringan):**
```bash
for i in $(seq 1 200); do
  adb shell am broadcast \
    -n com.google.android.apps.maps/com.google.android.apps.gmm.geofence.GeofenceBroadcastReceiver \
    -a com.google.android.apps.gmm.geofence.GeofenceBroadcastReceiver.GEOFENCE_RECEIVER_ACTION \
    --ei gms_error_code 0 \
    --ei com.google.android.location.intent.extra.transition 1 >/dev/null
done
```

### Rekomendasi
- Set `android:exported="false"` jika tidak perlu diakses app lain.
- Jika harus exported: lindungi dengan `android:permission` level `signature`.
- Tambahkan validasi asal caller (UID/package signature) sebelum memproses payload.
- Tambahkan rate-limit/debounce di receiver.

---

## Temuan 2 — Mixed Content / Information Leak Surface

### Kategori
- **Mixed content**
- **Information Leak**

### Bukti Teknis
- Aplikasi mengaktifkan `android:usesCleartextTraffic="true"`.
- Activity utama menerima beberapa deep link dengan scheme `http` (selain `https`) untuk domain `business.google.com`.

### Risiko
- Di jaringan yang dikontrol attacker (rogue Wi‑Fi, captive portal berbahaya), trafik cleartext/deep-link berbasis HTTP lebih rentan manipulasi, downgrade, metadata leakage.
- Meski banyak endpoint modern redirect ke HTTPS, posture ini tetap memperlebar attack surface.

### PoC Konseptual
- Trigger deep link HTTP dari app pihak ketiga/browser:
```bash
adb shell am start -a android.intent.action.VIEW \
  -d "http://business.google.com/message"
```
- Kombinasikan dengan mitm lab untuk observasi redirect chain, header leakage, atau parameter tampering.

### Rekomendasi
- Set `usesCleartextTraffic="false"` secara default.
- Gunakan Network Security Config dengan allowlist domain yang benar-benar perlu cleartext (jika ada legacy absolut).
- Hapus intent-filter HTTP jika tidak diwajibkan.

---

## Temuan 3 — Sensitive Data Exposure (Hardcoded API Key)

### Kategori
- **Sensitive data exposure**
- (potensi) **Abuse of backend quota**

### Bukti Teknis
- Nilai API key terlihat langsung di `meta-data` manifest (`AIza...`).

### Risiko
- Key publik di APK bisa diekstrak otomatis oleh attacker untuk abuse API, quota burn, atau intel gathering, **jika** pembatasan server-side tidak ketat (package name + SHA cert pinning + API restriction).

### Teknik PoC
1. Ekstrak key dari APK/manifest.
2. Uji akses ke endpoint Google API yang terkait menggunakan key tersebut.
3. Verifikasi apakah backend menolak request dari app signature/package yang tidak valid.

### Rekomendasi
- Pastikan semua key dibatasi ketat (Android app restriction + SHA-1/SHA-256 cert + API scope minim).
- Monitoring quota/anomaly dan auto-revocation policy.

---

## Temuan 4 — WebView Bridge Attack Surface (Candidate)

### Kategori
- **Cross-site scripting (XSS) -> bridge abuse** (kandidat)
- **Remote Code Execution (RCE)** *di konteks WebView JS bridge* (kandidat, tergantung kontrol URL + interface method)

### Bukti Teknis
- Ada pola `WebView.loadUrl(...)` dari string variabel lalu `setJavaScriptEnabled(true)` dan `addJavascriptInterface(...)` (`LighterEmbeddedWebBridge`).

### Risiko
- Jika URL bisa dipengaruhi input eksternal/deep link/server response tanpa validasi origin ketat, maka konten web attacker dapat berinteraksi dengan JS bridge.
- Dampak tergantung metode yang diekspos interface (tidak seluruh body class bridge dibedah di audit ini).

### PoC Arah Uji Lanjutan
- Dynamic instrumentation (Frida) untuk hook `loadUrl` & `addJavascriptInterface`, mapping asal URL dan method bridge yang callable.
- Fuzz parameter deep link/intent yang mengalir ke web URL.

### Rekomendasi
- Enforce allowlist origin + strict URL parser.
- Minimalkan/isolasi JS bridge, gunakan `@JavascriptInterface` hanya untuk method aman.
- Pertimbangkan `WebMessagePort`/postMessage dengan origin check eksplisit.

---

## Prioritas Perbaikan

1. **P1 (Segera)**: harden seluruh exported receiver/service/activity yang tidak perlu publik (authz boundary).
2. **P1**: matikan cleartext traffic global + bersihkan deep link HTTP.
3. **P2**: audit full semua WebView bridge flow (source URL trust).
4. **P2**: rotasi/restriksi API key + telemetry abuse detection.

---

## Catatan Validasi

Karena ini audit statis, klaim exploitability akhir perlu konfirmasi melalui:
- uji dinamis pada device emulasi/real,
- observability logcat/perfetto,
- verifikasi behavior di backend production vs staging.

Namun, dari sudut pandang secure-by-design Android, konfigurasi yang ditemukan **sudah cukup** untuk dikategorikan high-risk candidate dan layak remediation cepat.
